(this.webpackJsonpPrognosis=this.webpackJsonpPrognosis||[]).push([[0],{219:function(e,t,a){},220:function(e,t,a){},225:function(e,t){},227:function(e,t){},238:function(e,t){},240:function(e,t){},267:function(e,t){},269:function(e,t){},270:function(e,t){},275:function(e,t){},277:function(e,t){},283:function(e,t){},285:function(e,t){},304:function(e,t){},316:function(e,t){},319:function(e,t){},328:function(e,t,a){},330:function(e,t,a){"use strict";a.r(t);var n,r,s,o=a(0),c=a.n(o),i=a(20),l=a.n(i),d=(a(219),a(19)),u=a(392),h=a(388),p=(a(220),a(26)),j=a(21),b=a(31),m=a(390),f=a(94),g=new f.b({clientId:"<replace with client_public_id>",authorizeEndpoint:"https://na-1-dev.api.opentext.com/tenants/<replace with tenant_id>/oauth2/auth",tokenEndpoint:"https://na-1-dev.api.opentext.com/tenants/<replace with tenant_id>/oauth2/token",logoutEndpoint:"https://na-1-dev.api.opentext.com/tenants/<replace with tenant_id>/oauth2/logout",redirectUri:"https://localhost:4000",scopes:["openid","otds:groups"]}),O=function(){return(n=n||Object(b.a)(Object(j.a)().mark((function e(){return Object(j.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",g.authorize());case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)},x=function(e){return(r=r||Object(b.a)(Object(j.a)().mark((function e(t){return Object(j.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",g.logout(t));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)},v=function(e,t){x(e),window.sessionStorage.removeItem("ca_token_expiration_time"),window.location.replace("https://na-1-dev.api.opentext.com/tenants/<replace with tenant_id>/oauth2/logout?id_token_hint="+encodeURIComponent(t)+"&post_logout_redirect_uri="+encodeURIComponent("https://localhost:4000"))},C=void 0,k=0;m.a.interceptors.response.use((function(e){return e}),(function(e){return(s=s||Object(b.a)(Object(j.a)().mark((function e(t){var a,n;return Object(j.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=null===t||void 0===t?void 0:t.config,401!==(null===t||void 0===t||null===(a=t.response)||void 0===a?void 0:a.status)||null!==n&&void 0!==n&&n.sent){e.next=9;break}return n.sent=!0,1===++k&&(C=g.fetchToken(g.getAuthTokens().refresh_token,!0)),e.next=7,C.then((function(e){e.access_token&&(n.headers=Object(p.a)(Object(p.a)({},n.headers),{},{Authorization:"Bearer ".concat(e.access_token)}))}));case 7:return k--,e.abrupt("return",Object(m.a)(n));case 9:return e.abrupt("return",Promise.reject(t));case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}));var y=a(331),w=a(201),S=a(397),_=a(1);var D=function(e){var t=e.authContext,a=e.logout,n=Object(o.useState)(null),r=Object(d.a)(n,2),s=r[0],c=r[1],i=function(){c(null)};return Object(_.jsxs)("header",{className:"page-header",children:[Object(_.jsx)("div",{className:"logo logo-ot-appworks"}),Object(_.jsx)("div",{className:"header-title",children:"Contract Approval"}),Object(_.jsxs)("div",{className:"header-menu",children:[Object(_.jsx)(y.a,{"aria-controls":"simple-menu","aria-haspopup":"true",onClick:function(e){c(e.currentTarget)},children:t.userName}),Object(_.jsx)(w.a,{anchorOrigin:{vertical:"bottom",horizontal:"center"},getContentAnchorEl:null,anchorEl:s,keepMounted:!0,open:Boolean(s),onClose:i,children:Object(_.jsx)(S.a,{onClick:function(){a(!0,t.idToken),i()},children:"Logout"})})]})]})},N=a(3),T=["children","value","index"];var A=function(e){var t=e.children,a=e.value,n=e.index,r=Object(N.a)(e,T);return Object(_.jsx)("div",Object(p.a)(Object(p.a)({role:"tabpanel",hidden:a!==n},r),{},{children:a===n&&Object(_.jsx)("div",{children:t})}))},B=a(18),I=a(14),P=a(16),R=a(28),E=a(29),M=a(381),V=a(332),z=a(382),q=a(383),L=a(384),F=a(373),W=a(385),Y=a(386),U=a(372),H=a(333),G=a(387),J=a(396),Z=a(70),K=a.n(Z),$=a(71),Q=a.n($),X=a(395),ee=function(e){Object(R.a)(a,e);var t=Object(E.a)(a);function a(){var e;Object(B.a)(this,a);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).onChangePage=function(t,a){e.props.handlePageNumber(a)},e}return Object(I.a)(a,[{key:"render",value:function(){return Object(_.jsx)(X.a,{rowsPerPageOptions:[10],component:"div",count:this.props.count,rowsPerPage:10,page:this.props.pageNumber,onPageChange:this.onChangePage})}}]),a}(c.a.Component),te=function(e,t,a){function n(e){Object(B.a)(this,n),this.url="https://na-1-dev.api.opentext.com/workflow/v1/tasks",this.props=e}return Object(I.a)(n,[{key:"getTasks",value:function(t){return(e=e||Object(b.a)(Object(j.a)().mark((function e(t){return Object(j.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(m.a)({method:"get",url:this.url+"?sort=createTime&order=desc&name="+encodeURIComponent(this.props.taskname)+"&candidateOrAssigned="+encodeURIComponent(this.props.authContext.userName)+"&includeProcessVariables=true"+(t?"&offset="+t:""),headers:this.props.authContext.headers}).catch((function(e){alert(null!=e.response&&null!=e.response.data?e.response.data:e.message)})));case 1:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}},{key:"claimTask",value:function(e){return(t=t||Object(b.a)(Object(j.a)().mark((function e(t){return Object(j.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(m.a)({method:"post",url:this.url+"/"+t,headers:this.props.authContext.headers,data:{action:"claim",assignee:this.props.authContext.userName}}).catch((function(e){alert(null!=e.response&&null!=e.response.data?e.response.data:e.message)})));case 1:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}},{key:"completeTask",value:function(e,t){return(a=a||Object(b.a)(Object(j.a)().mark((function e(t,a){return Object(j.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(m.a)({method:"post",url:this.url+"/"+t,headers:this.props.authContext.headers,data:{action:"complete",outcome:a?"approved":"rejected",variables:[{name:"approver",value:this.props.authContext.userName}]}}));case 1:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}}]),n}(),ae=a(376),ne=a(377),re=a(378),se=a(399),oe=a(380),ce=function(e){Object(R.a)(a,e);var t=Object(E.a)(a);function a(e){var n;return Object(B.a)(this,a),(n=t.call(this,e)).state={selectedTask:e.selectedTask},n}return Object(I.a)(a,[{key:"componentDidUpdate",value:function(e){e.open===this.props.open&&e.selectedTask===this.props.selectedTask||this.setState({selectedTask:this.props.selectedTask})}},{key:"closeDialog",value:function(){this.props.onClose()}},{key:"getDateValue",value:function(e){return e?new Date(Date.parse(e)).toLocaleString():""}},{key:"getContractName",value:function(e){return e&&e.variables[0]?e.variables.find((function(e){return"contract"===e.name})).value.name:""}},{key:"getRequesterEmail",value:function(e){return e&&e.variables[0]?e.variables.find((function(e){return"contract"===e.name})).value.properties.requester_email:""}},{key:"getContractValue",value:function(e){return e&&e.variables[0]?e.variables.find((function(e){return"contract"===e.name})).value.properties.value:""}},{key:"render",value:function(){var e=this;return Object(_.jsxs)(ae.a,{open:this.props.open,"aria-labelledby":"form-dialog-title",children:[Object(_.jsx)(ne.a,{id:"form-dialog-title",children:"Task details"}),Object(_.jsxs)(re.a,{children:[Object(_.jsx)(se.a,{margin:"dense",id:"name",label:"Task name",value:this.state.selectedTask.name,type:"text",fullWidth:!0}),Object(_.jsx)(se.a,{margin:"dense",id:"assignee",label:"Assignee",value:this.state.selectedTask.assignee||"",type:"text",fullWidth:!0}),Object(_.jsx)(se.a,{margin:"dense",id:"createTime",label:"Creation date",value:this.getDateValue(this.state.selectedTask.createTime),type:"text",InputLabelProps:{shrink:!0},fullWidth:!0}),Object(_.jsx)(se.a,{margin:"dense",id:"cmsName",label:"Contract name",value:this.getContractName(this.state.selectedTask),type:"text",fullWidth:!0}),Object(_.jsx)(se.a,{margin:"dense",id:"cmsEmail",label:"Requester email address",value:this.getRequesterEmail(this.state.selectedTask),type:"text",fullWidth:!0}),Object(_.jsx)(se.a,{margin:"dense",id:"cmsValue",label:"Contract value",value:this.getContractValue(this.state.selectedTask),type:"text",fullWidth:!0})]}),Object(_.jsx)(oe.a,{children:Object(_.jsx)(y.a,{onClick:function(){e.closeDialog()},variant:"contained",color:"primary",children:"Close"})})]})}}]),a}(c.a.Component),ie=(a(328),"file-viewer-root");var le=function(e){var t=e.closeDialog,a=e.publicationData,n=Object(o.useState)(null),r=Object(d.a)(n,2),s=r[0],c=r[1],i=Object(f.c)().authService,l=Object(o.useCallback)((function(){m.a.get("https://na-1-dev.api.opentext.com/viewer/api/v1/viewers/brava-view-1.x/loader",{headers:{Authorization:"Bearer ".concat(i.getAuthTokens().access_token)}}).then((function(e){if(e.data){var t=document.createElement("script");t.appendChild(document.createTextNode(e.data)),document.getElementsByTagName("head")[0].appendChild(t)}}))}),[i]);return Object(o.useEffect)((function(){window.addEventListener("bravaReady",(function(e){var a=window.location.origin;e.origin&&e.origin!==a||e.target&&e.target.origin===a&&(window.addEventListener(e.detail+"-close",(function(){t()})),c(window[e.detail]))})),l()}),[t,l]),Object(o.useEffect)((function(){s&&(s.setHttpHeaders({Authorization:"Bearer ".concat(i.getAuthTokens().access_token)}),s.setScreenBanner("Viewer Service by OpenText | Document Viewed at %Time"),s.enableMarkup(!0),s.editableMarkupPredicate=function(){return!0},s.commentableMarkupPredicate=function(){return!0},s.visibleToolPropertyPredicate=function(){return!0},s.deletableMarkupPredicate=function(){return!0},s.deletableStampPredicate=function(){return!0},s.editableStampPredicate=function(){return!0},s.addableStampPredicate=function(){return!0},s.setMarkupHost(window.ViewerAuthority),s.setUserName(i.getUser().preferred_username),s.setScreenWatermark("ORIGINAL"),s.setLayout({topToolbar:"toolbarWithMarkupStuff",toolbarWithMarkupStuff:{left:[{component:"ToggleSidebarButton",side:"tabContainerWithMarkups"},{component:"DownloadButton"},{component:"PanButton"},{component:"ZoomToRectangleButton"},{component:"SaveButton"},{component:"ZoomInButton"},{component:"ZoomOutButton"},{component:"ZoomExtentsButton"},{component:"ZoomWidthButton"},{component:"RotateButton"}],center:[{component:"TitleText"}],right:[{component:"PageSelector",style:{marginLeft:"0.5em"}},{component:"CloseButton",size:18}]},mainContainer:[{component:"TabContainer",layoutKey:"tabContainerWithMarkups"},{component:"PageContainer"}],tabContainerWithMarkups:{sidebarName:"tabContainerWithMarkups",primary:"primary",tabs:[{component:"ThumbnailPane",title:"tab.thumbnails"},{component:"MarkupPane",title:"tab.markups",layoutKey:"markupTools"}]},markupTools:[{title:"Tools",tools:[{label:"select markup",tool:"select",icon:"Select"}]},{title:"toolPalette.annotations",tools:[{label:"text",tool:"text",icon:"Text",props:{}},{label:"arrow",tool:"arrow",icon:"Arrow",props:{}},{label:"ellipse",tool:"ellipse",icon:"Ellipse",props:{}},{label:"arc",tool:"arc",icon:"Arc",props:{}},{label:"scratchout",tool:"scratchout",icon:"Scratchout",props:{}},{label:"cloudRectangle",tool:"cloudRectangle",icon:"CloudRectangle",props:{}},{label:"cloudPolygon",tool:"cloudPolygon",icon:"CloudPolygon",props:{}},{label:"openSketch",tool:"openSketch",icon:"OpenSketch"},{label:"closedSketch",tool:"closedSketch",icon:"ClosedSketch"},{label:"line",tool:"line",icon:"Line",props:{}},{label:"polyline",tool:"polyline",icon:"Polyline",props:{closed:!1}},{label:"crossout",tool:"crossout",icon:"Crossout",props:{}},{label:"rectangle",tool:"rectangle",icon:"Rectangle",props:{}},{label:"polygon",tool:"polygon",icon:"Polygon",props:{closed:!0}},{label:"highlight",tool:"highlight",icon:"Highlight"},{label:"roundedRectangle",tool:"roundedRectangle",icon:"RoundedRectangle"},{label:"changemark",tool:"changemark",icon:"Changemark",props:{fill:"#f05822dd"}},{label:"raster",tool:"raster",icon:"Raster"},{label:"stamp",tool:"stamp",icon:"Stamp"}]},{title:"toolPalette.text",tools:[{label:"textScratch",tool:"textScratch",icon:"TextScratchout"},{label:"textUnderline",tool:"textUnderline",icon:"TextUnderline"},{label:"textStrike",tool:"textStrike",icon:"TextStrikeThrough"},{label:"textHighlight",tool:"textHighlight",icon:"TextHighlight"}]},{title:"toolPalette.redactions",tools:[{label:"redactionRectangle",tool:"redactionRectangle",icon:"RedactArea"},{label:"redactionText",tool:"redactionText",icon:"RedactText"},{label:"peekRectangle",tool:"peekRectangle",icon:"RedactPeek"}]}]}),s.addPublication(a,!0),s.render(ie))}),[s,a,i]),Object(_.jsx)("div",{id:ie})},de="https://na-1-dev.api.opentext.com";var ue=function(e){var t=e.fileId,a=e.open,n=e.onClose,r=Object(o.useRef)(a),s=Object(o.useState)(""),c=Object(d.a)(s,2),i=c[0],l=c[1],u=Object(f.c)().authService;return Object(o.useEffect)((function(){r.current!==a&&(r.current=a,a&&function(e){var t="";Object(m.a)({method:"get",url:de+"/cms/instances/file/ca_contract/"+e+"/contents",headers:{Authorization:"Bearer ".concat(u.getAuthTokens().access_token)}}).then((function(e){var a="";e&&e.data&&e.data._embedded&&e.data._embedded.collection&&e.data._embedded.collection.forEach((function(e){"Brava rendition"===e.name&&(a=e.blob_id)})),a&&Object(m.a)({method:"get",url:de+"/css/v2/content/"+a+"/download?avs-scan=false",headers:{Authorization:"Bearer ".concat(u.getAuthTokens().access_token)}}).then((function(e){"Complete"===e.data.status&&(t=e)&&l(t.data)})).catch((function(e){alert(null!=e.response&&null!=e.response.data?e.response.data:e.message)}))})).catch((function(e){alert(null!=e.response&&null!=e.response.data?e.response.data:e.message)}))}(t))}),[u,t,a]),Object(_.jsx)(ae.a,{open:a,"aria-labelledby":"customized-dialog-title",fullScreen:!0,maxWidth:"md",children:Object(_.jsx)(re.a,{children:Object(_.jsx)(le,{closeDialog:n,publicationData:i})})})},he=a(391),pe=a(199),je=a.n(pe),be=function(e){Object(R.a)(a,e);var t=Object(E.a)(a);function a(e){var n;return Object(B.a)(this,a),(n=t.call(this,e)).state={selectedContract:{name:"",properties:{},create_time:""}},n}return Object(I.a)(a,[{key:"formatExtractedTerms",value:function(e){return e?e.map((function(e){return e.startsWith("**")?Object(_.jsx)("b",{children:Object(_.jsx)("p",{children:e.substring(2)})}):Object(_.jsxs)("p",{children:["- ",e]})})):""}},{key:"componentDidUpdate",value:function(e,t,a){e.open===this.props.open&&e.selectedContract===this.props.selectedContract||this.setState({selectedContract:this.props.selectedContract})}},{key:"closeDialog",value:function(){this.props.onClose()}},{key:"render",value:function(){var e=this;return Object(_.jsxs)(ae.a,{open:this.props.open,"aria-labelledby":"form-dialog-title",children:[Object(_.jsx)(ne.a,{id:"form-dialog-title",children:"Extracted Terms"}),Object(_.jsx)(re.a,{children:Object(_.jsx)("div",{children:this.formatExtractedTerms(this.state.selectedContract.properties.extracted_terms)})}),Object(_.jsx)(oe.a,{children:Object(_.jsx)(y.a,{onClick:function(){e.closeDialog()},variant:"contained",color:"primary",children:"Close"})})]})}}]),a}(c.a.Component),me=["NONE","LOW","MEDIUM","HIGH","VERY HIGH"],fe=function(e){Object(R.a)(a,e);var t=Object(E.a)(a);function a(e){var n;return Object(B.a)(this,a),(n=t.call(this,e)).state={openExtractedPersonalData:!1,row:e.row},n.handleCloseExtractedPersonalData=n.handleCloseExtractedPersonalData.bind(Object(P.a)(n)),n}return Object(I.a)(a,[{key:"showExtractedPersonalData",value:function(){this.setState({openExtractedPersonalData:!0})}},{key:"handleCloseExtractedPersonalData",value:function(){this.setState({openExtractedPersonalData:!1})}},{key:"render",value:function(){var e=this;return Object(_.jsxs)("div",{children:[me[this.state.row.properties.risk_classification-1],Object(_.jsx)(U.a,{size:"small",variant:"outlined",color:"primary",title:"Show extracted personal data",onClick:function(){e.showExtractedPersonalData(e.state.row)},children:Object(_.jsx)(je.a,{})}),Object(_.jsx)(be,{open:this.state.openExtractedPersonalData,selectedContract:this.state.row,onClose:this.handleCloseExtractedPersonalData})]})}}]),a}(o.Component),ge=function(e){return Object(_.jsx)(he.a,Object(p.a)({elevation:6,variant:"filled"},e))},Oe=function(e){Object(R.a)(a,e);var t=Object(E.a)(a);function a(e){var n;return Object(B.a)(this,a),(n=t.call(this,e)).state={detailsOpen:!1,selectedTask:{variables:[]},tasks:[],count:-1,page:0,openDocumentDialogView:!1,fileId:"",fileName:"",showBackdrop:!1,showSnackBar:!1,snackBarMessage:"",snackBarSeverity:"success"},n.handleCloseTaskDetails=n.handleCloseTaskDetails.bind(Object(P.a)(n)),n.onChangePage=n.onChangePage.bind(Object(P.a)(n)),n.handleCloseDocumentDialogView=n.handleCloseDocumentDialogView.bind(Object(P.a)(n)),n.handleSnackBarClose=n.handleSnackBarClose.bind(Object(P.a)(n)),n}return Object(I.a)(a,[{key:"componentDidMount",value:function(){this.taskService=new te(this.props),this.getTasks()}},{key:"componentDidUpdate",value:function(e,t){t.page!==this.state.page&&this.getTasks()}},{key:"getTasks",value:function(){var e=this;this.setState({showBackdrop:!0}),this.taskService.getTasks(10*this.state.page).then((function(t){t&&t.data&&t.data._embedded?(!t.data._links.next||t.data._embedded.tasks.length<10)&&e.setState({count:10*e.state.page+t.data._embedded.tasks.length,tasks:t.data._embedded.tasks}):e.setState({count:0,tasks:[]})})).finally((function(){e.setState({showBackdrop:!1})}))}},{key:"onChangePage",value:function(e){this.setState({page:e})}},{key:"claimTask",value:function(e){var t=this;this.setState({showBackdrop:!0}),this.taskService.claimTask(e).then((function(){t.getTasks()}))}},{key:"completeTask",value:function(e,t){var a=this;this.setState({showBackdrop:!0}),this.taskService.completeTask(e,t).then((function(){a.getTasks(),a.setState({snackBarMessage:"Contract "+(t?"approved":"rejected")+" successfully.",showSnackBar:!0})})).catch((function(e){var n="Could not "+(t?"approve ":"reject ")+"task: ";null!=e.response&&null!=e.response.data?n+=e.response.data.exception:n+=e.message,a.setState({snackBarSeverity:"error",snackBarMessage:n,showSnackBar:!0})})).finally((function(){a.setState({showBackdrop:!1})}))}},{key:"showDetails",value:function(e){this.setState({selectedTask:e,detailsOpen:!0})}},{key:"getContractName",value:function(e){return e&&e.variables?e.variables.find((function(e){return"contract"===e.name})).value.name:""}},{key:"getContractValue",value:function(e){if(e&&e.variables){var t=e.variables.find((function(e){return"contract"===e.name}));return t.value.properties?t.value.properties.value:""}return""}},{key:"getContract",value:function(e){if(e&&e.variables){var t=e.variables.find((function(e){return"contract"===e.name}));return t.value.properties?t.value:""}return""}},{key:"getDateValue",value:function(e){return e&&e.createTime?new Date(Date.parse(e.createTime)).toLocaleString():""}},{key:"handleCloseTaskDetails",value:function(){this.setState({detailsOpen:!1})}},{key:"handleCloseDocumentDialogView",value:function(){this.setState({openDocumentDialogView:!1})}},{key:"handleSnackBarClose",value:function(){this.setState({showSnackBar:!1})}},{key:"openDocumentDialogView",value:function(e,t){this.setState({openDocumentDialogView:!0,fileId:e,fileName:t})}},{key:"render",value:function(){var e=this;return Object(_.jsxs)("div",{children:[Object(_.jsx)("div",{className:"content-header",children:"All Tasks"}),Object(_.jsx)(M.a,{component:V.a,children:Object(_.jsxs)(z.a,{size:"small","aria-label":"a dense table",children:[Object(_.jsx)(q.a,{children:Object(_.jsxs)(L.a,{children:[Object(_.jsx)(F.a,{align:"left",children:"Contract name"}),Object(_.jsx)(F.a,{align:"left",children:"Creation date"}),Object(_.jsx)(F.a,{align:"left",children:"Value"}),Object(_.jsx)(F.a,{align:"left",children:"Risk classification"}),Object(_.jsx)(F.a,{align:"left",children:"Assignee"}),Object(_.jsx)(F.a,{align:"left",children:"View document"}),Object(_.jsx)(F.a,{align:"left",children:"Action"}),Object(_.jsx)(F.a,{align:"center"})]})}),Object(_.jsx)(W.a,{children:this.state.tasks.map((function(t){return Object(_.jsxs)(L.a,{children:[Object(_.jsx)(F.a,{align:"left",children:e.getContractName(t)}),Object(_.jsx)(F.a,{align:"left",children:e.getDateValue(t)}),Object(_.jsx)(F.a,{align:"left",children:e.getContractValue(t)}),Object(_.jsx)(F.a,{align:"left",children:Object(_.jsx)(fe,{row:e.getContract(t)})}),Object(_.jsx)(F.a,{align:"left",children:t.assignee||""}),Object(_.jsx)(F.a,{align:"left",children:Object(_.jsx)(y.a,{size:"small",variant:"outlined",color:"primary",onClick:function(){e.openDocumentDialogView(e.getContract(t).id,e.getContractName(t))},children:"Original"})}),Object(_.jsx)(F.a,{align:"left",children:t.assignee?Object(_.jsxs)(Y.a,{children:[Object(_.jsx)(y.a,{size:"small",variant:"outlined",color:"primary",onClick:function(){e.completeTask(t.id,!0)},children:"Approve"}),Object(_.jsx)(y.a,{size:"small",variant:"outlined",color:"primary",onClick:function(){e.completeTask(t.id,!1)},children:"Reject"})]}):Object(_.jsx)(y.a,{size:"small",variant:"outlined",color:"primary",onClick:function(){e.claimTask(t.id)},children:"Claim"})}),Object(_.jsx)(F.a,{align:"center",children:Object(_.jsx)(U.a,{size:"small",variant:"outlined",color:"primary",title:"Show details",onClick:function(){e.showDetails(t)},children:Object(_.jsx)(K.a,{})})})]},t.id)}))})]})}),Object(_.jsx)(ee,{pageNumber:this.state.page,count:this.state.count,handlePageNumber:this.onChangePage}),Object(_.jsx)(ce,{open:this.state.detailsOpen,selectedTask:this.state.selectedTask,onClose:this.handleCloseTaskDetails}),Object(_.jsx)(ue,{open:this.state.openDocumentDialogView,fileId:this.state.fileId,onClose:this.handleCloseDocumentDialogView}),Object(_.jsx)(H.a,{style:{zIndex:9999},open:this.state.showBackdrop,children:Object(_.jsx)(G.a,{color:"inherit"})}),Object(_.jsx)(J.a,{anchorOrigin:{vertical:"bottom",horizontal:"center"},open:this.state.showSnackBar,autoHideDuration:5e3,onClose:this.handleSnackBarClose,action:Object(_.jsx)(c.a.Fragment,{children:Object(_.jsx)(U.a,{size:"small","aria-label":"close",color:"inherit",onClick:this.handleSnackBarClose,children:Object(_.jsx)(Q.a,{fontSize:"small"})})}),children:Object(_.jsx)(ge,{onClose:this.handleSnackBarClose,severity:this.state.snackBarSeverity,children:this.state.snackBarMessage})})]})}}]),a}(c.a.Component),xe=a(200),ve=a.n(xe),Ce="https://na-1-dev.api.opentext.com";var ke=function(e){var t,a=e.parentRaiseError,n=e.parent,r=e.open,s=e.onClose,c=e.selectedContract,i=Object(o.useRef)(r),l=Object(o.useRef)(c),g=Object(o.useState)(0),O=Object(d.a)(g,2),x=O[0],v=O[1],C=Object(o.useState)({name:"",properties:{},traits:{},create_time:""}),k=Object(d.a)(C,2),w=k[0],S=k[1],D=Object(o.useState)(),N=Object(d.a)(D,2),T=N[0],B=N[1],I=Object(f.c)().authService,P=function(e){return"boolean"==typeof e?e.toString():e||""};return Object(o.useEffect)((function(){var e,t,o=function(e){s(),a(n,e)};i.current===r&&l.current===c||(i.current=r,l.current=c,S({}),function(){(e=e||Object(b.a)(Object(j.a)().mark((function e(){return Object(j.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(m.a)({method:"get",url:"".concat(Ce,"/cms/instances/file/").concat(c.type,"/").concat(c.id),headers:{Authorization:"Bearer ".concat(I.getAuthTokens().access_token)}}).then((function(e){S(e.data)})).catch((function(e){var t="Could not fetch ".concat(c.type," with Id ").concat(c.id,": ");null!=e.response&&null!=e.response.data?t+=e.response.data.exception:t+=e.message,o(t)}));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}(),function(){(t=t||Object(b.a)(Object(j.a)().mark((function e(){return Object(j.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(m.a)({method:"get",url:"".concat(Ce,"/cms/instances/file/").concat(c.type,"/").concat(c.id,"/acl"),headers:{Authorization:"Bearer ".concat(I.getAuthTokens().access_token)}}).then((function(e){B(e.data)})).catch((function(e){var t="Could not fetch ACL for ".concat(c.type," with Id ").concat(c.id,": ");null!=e.response&&null!=e.response.data?t+=e.response.data.exception:t+=e.message,o(t)}));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}())}),[r,c,I,s,n,a]),Object(_.jsx)(_.Fragment,{children:w.id&&Object(_.jsxs)(ae.a,{open:r,"aria-labelledby":"form-dialog-title",children:[Object(_.jsx)(ne.a,{id:"form-dialog-title",children:"Contract details"}),Object(_.jsxs)(re.a,{className:"contract-details",children:[Object(_.jsxs)(u.a,{orientation:"horizontal",value:x,onChange:function(e,t){v(t)},children:[Object(_.jsx)(h.a,{className:"tab-caption",label:"Properties"}),Object(_.jsx)(h.a,{className:"tab-caption",label:"Permissions"}),Object(_.jsx)(h.a,{className:"tab-caption",label:"Approvals"})]}),Object(_.jsxs)(A,{value:x,index:0,children:[Object(_.jsx)(se.a,{margin:"dense",id:"contract-name",label:"Name",value:w.name,type:"text",fullWidth:!0}),Object(_.jsx)(se.a,{margin:"dense",id:"contract-status",label:"Status",value:w.properties.status,type:"text",fullWidth:!0}),Object(_.jsx)(se.a,{margin:"dense",id:"contract-value",label:"Value",value:w.properties.value,type:"text",fullWidth:!0}),"ca_loan_contract"===w.type&&Object(_.jsxs)(_.Fragment,{children:[Object(_.jsx)(se.a,{margin:"dense",id:"monthly-installments",label:"Monthly installments",value:w.properties.monthly_installments,type:"text",fullWidth:!0}),Object(_.jsx)(se.a,{margin:"dense",id:"yearly-income",label:"Yearly income",value:w.properties.yearly_income,type:"text",fullWidth:!0})]}),Object(_.jsx)(se.a,{margin:"dense",id:"contract-risk",label:"Risk classification",value:w.properties.risk_classification,type:"text",fullWidth:!0}),Object(_.jsx)(se.a,{margin:"dense",id:"createTime",label:"Creation date",value:(t=w.create_time,t?new Date(Date.parse(t)).toLocaleString():""),type:"text",InputLabelProps:{shrink:!0},fullWidth:!0}),Object(_.jsx)(se.a,{margin:"dense",id:"contract-requester-email",label:"Contract requester email",value:w.properties.requester_email,type:"text",fullWidth:!0})]}),Object(_.jsx)(A,{value:x,index:1,children:(null===T||void 0===T?void 0:T.permits)&&Object(_.jsx)(M.a,{children:Object(_.jsxs)(z.a,{children:[Object(_.jsx)(q.a,{children:Object(_.jsxs)(L.a,{children:[Object(_.jsx)(F.a,{align:"left",children:"Identity"}),Object(_.jsx)(F.a,{align:"left",children:"Permissions"})]})}),Object(_.jsx)(W.a,{children:T.permits.map((function(e){return Object(p.a)(Object(p.a)({},e),{},{display_name:"subscription_group"===P(e.identity_type)?e.group_name:e.identity})})).sort((function(e,t){return e.display_name>t.display_name?1:-1})).map((function(e){return Object(_.jsxs)(L.a,{children:[Object(_.jsx)(F.a,{align:"left",style:{verticalAlign:"top"},children:e.display_name}),Object(_.jsx)(F.a,{align:"left",style:{verticalAlign:"top"},children:e.permissions.sort((function(e,t){return e>t?1:-1})).map((function(e){return Object(_.jsx)("li",{children:e},e)}))})]},e.identity)}))})]})})}),Object(_.jsx)(A,{value:x,index:2,children:Object(_.jsx)(M.a,{children:Object(_.jsxs)(z.a,{children:[Object(_.jsx)(q.a,{children:Object(_.jsxs)(L.a,{children:[Object(_.jsx)(F.a,{}),Object(_.jsx)(F.a,{align:"right",children:"Required"}),Object(_.jsx)(F.a,{align:"right",children:"Granted"}),Object(_.jsx)(F.a,{align:"right",children:"Approver"}),Object(_.jsx)(F.a,{align:"right",children:"Approver role"}),Object(_.jsx)(F.a,{align:"right",children:"Approval date"})]})}),Object(_.jsx)(W.a,{children:function(e){var t=[];for(var a in e){var n=e[a];n.trait_name=a,t.push(n)}return t.sort((function(e,t){return e.trait_name<t.trait_name?-1:1}))}(w.traits.ca_approval).map((function(e){return Object(_.jsxs)(L.a,{children:[Object(_.jsx)(F.a,{component:"th",scope:"row",children:P(e.trait_name)}),Object(_.jsx)(F.a,{align:"right",children:P(e.is_required)}),Object(_.jsx)(F.a,{align:"right",children:P(e.has_been_granted)}),Object(_.jsx)(F.a,{align:"right",children:P(e.approver)}),Object(_.jsx)(F.a,{align:"right",children:P(e.approver_role)}),Object(_.jsx)(F.a,{align:"right",children:P(e.approval_date)})]},e.trait_name)}))})]})})})]}),Object(_.jsx)(oe.a,{children:Object(_.jsx)(y.a,{onClick:function(){s()},variant:"contained",color:"primary",children:"Close"})})]})})},ye=a(401),we=a(389),Se=a(393),_e=a(379),De=a(400),Ne=a(394),Te=function(e){function t(e){Object(B.a)(this,t),this.calculateRisk=function(e){var t=["**Social Security Numbers:"],a=["**Credit Card Numbers:"],n=["**Bank Accounts:"],r=["**Person Names:"],s=["**Phone Numbers:"],o=["**Addresses:"],c=["**Geographic Locations:"],i=["**Organization Names:"],l=1,d=0,u=0;e.data.results.tme.result.Results.nfinder[0].nfExtract[0].ExtractedTerm.forEach((function(e){switch(e.CartridgeID){case"PN":e.ConfidenceScore>60&&(e.nfinderNormalized?r.push(e.nfinderNormalized):e.MainTerm.value&&r.push(e.MainTerm.value),d++);break;case"Phone":e.ConfidenceScore>60&&(s.push(e.nfinderNormalized),u++);break;case"Address":e.ConfidenceScore>60&&o.push(e.nfinderNormalized);break;case"GL":e.ConfidenceScore>60&&c.push(e.MainTerm.value);break;case"ON":e.ConfidenceScore>60&&(e.nfinderNormalized?i.push(e.nfinderNormalized):e.MainTerm.value&&i.push(e.MainTerm.value));break;case"SSN":t.push(e.ClientNormalized),l<5&&(l=5);break;case"CreditCard":a.push(e.ClientNormalized),l<4&&(l=4);break;case"BankAccount":n.push(e.ClientNormalized),l<2&&(l=2)}l<3&&(d>=5||d>2&&u>2)&&(l=3)}));var h=[].concat(t,a,n,r,s,o,c,i);return{riskClassification:l,extractedTerms:h}},this.props=e}return Object(I.a)(t,[{key:"processDoc",value:function(t,a){return(e=e||Object(b.a)(Object(j.a)().mark((function e(t,a){var n,r,s=this;return Object(j.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=new FormData).append("File",t,a),r={method:"post",url:"https://na-1-dev.api.opentext.com/mtm-riskguard/api/v1/process",headers:{Authorization:this.props.authContext.headers.Authorization,"Content-Type":"multipart/form-data"},data:n},e.abrupt("return",new Promise((function(e,t){Object(m.a)(r).then((function(t){e({data:s.calculateRisk(t)})})).catch((function(e){t(e.response)}))})));case 4:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}}]),t}(),Ae=c.a.createContext(),Be=function(e){var t=e.children,a=Object(o.useState)(""),n=Object(d.a)(a,2),r=n[0],s=n[1];return Object(_.jsx)(Ae.Provider,{value:{appRootFolderId:r,updateAppRootFolderId:function(e){s(e)}},children:t})},Ie=Ae,Pe="https://na-1-dev.api.opentext.com",Re=function(e,t){Object(R.a)(n,e);var a=Object(E.a)(n);function n(e){var t;return Object(B.a)(this,n),(t=a.call(this,e)).selectFile=function(e){var a=e.target.files[0];t.setState({selectedFile:a}),t.fileNameText.innerHTML=a.name,/\.pdf$/.test(a.name)||(t.fileNameText.innerHTML+="<br/><b>Note: This application only supports pdf files.</b>")},t.setFileNameInputRef=function(e){t.fileNameText=e},t.handleChangeContractType=t.handleChangeContractType.bind(Object(P.a)(t)),t.handleChangeContractName=t.handleChangeContractName.bind(Object(P.a)(t)),t.handleChangeContractValue=t.handleChangeContractValue.bind(Object(P.a)(t)),t.handleChangeContractRequesterEmail=t.handleChangeContractRequesterEmail.bind(Object(P.a)(t)),t.handleChangeContractMonthlyInstallments=t.handleChangeContractMonthlyInstallments.bind(Object(P.a)(t)),t.handleChangeContractYearlyIncome=t.handleChangeContractYearlyIncome.bind(Object(P.a)(t)),t.canSubmit=t.canSubmit.bind(Object(P.a)(t)),t.state={showBackdrop:!1,selectedContract:{newContractType:"",newContractName:"",newContractValue:"",newContractRequesterEmail:"",newContractMonthlyInstallments:"",newContractYearlyIncome:"",selectedFile:""},riskGuard:{contractRisk:"",extractedTerms:""}},t}return Object(I.a)(n,[{key:"closeDialog",value:function(){this.setState({newContractType:"",newContractName:"",newContractValue:"",newContractRequesterEmail:"",newContractMonthlyInstallments:"",newContractYearlyIncome:"",showBackdrop:!1}),this.props.onClose()}},{key:"handleChangeContractType",value:function(e){this.setState({newContractType:e.target.value,newContractMonthlyInstallments:"",newContractYearlyIncome:""})}},{key:"handleChangeContractName",value:function(e){this.setState({newContractName:e.target.value})}},{key:"handleChangeContractValue",value:function(e){this.setState({newContractValue:e.target.value})}},{key:"handleChangeContractRequesterEmail",value:function(e){this.setState({newContractRequesterEmail:e.target.value})}},{key:"handleChangeContractMonthlyInstallments",value:function(e){this.setState({newContractMonthlyInstallments:e.target.value})}},{key:"handleChangeContractYearlyIncome",value:function(e){this.setState({newContractYearlyIncome:e.target.value})}},{key:"submitContract",value:function(){return(t=t||Object(b.a)(Object(j.a)().mark((function e(){var t,a,n,r,s,o,c,i=this;return Object(j.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({showBackdrop:!0}),t=new Te(this.props),e.next=4,t.processDoc(this.state.selectedFile,this.state.selectedFile.name);case 4:if(a=e.sent,this.setState({contractRisk:a.data.riskClassification,extractedTerms:a.data.extractedTerms}),""!==this.context.appRootFolderId){e.next=9;break}return e.next=9,m.a.get(Pe+"/cms/instances/folder/cms_folder?filter=name eq 'Contract Approval App'",{headers:this.props.authContext.headers}).then((function(e){if(e.data._embedded){var t=e.data._embedded.collection[0].id;(0,i.context.updateAppRootFolderId)(t)}}));case 9:if(""!==this.context.appRootFolderId){e.next=13;break}return e.next=13,m.a.post(Pe+"/cms/instances/folder/cms_folder",{name:"Contract Approval App"},{headers:this.props.authContext.headers}).then((function(e){if(e.data){var t=e.data.id;(0,i.context.updateAppRootFolderId)(t)}})).catch((function(e){var t;t=401===e.response.status?"Error creating App Root Folder: You are not authorized to access this resource. Your session might have timed out.":"Error creating App Root Folder: ".concat(JSON.stringify(e.response.data,null,2)),i.props.onAddContract("Error creating contract: "+t)}));case 13:return n=this.context.appRootFolderId,r=this.state.newContractRequesterEmail,s="",e.next=19,m.a.get("".concat(Pe,"/cms/instances/folder/ca_customer?filter=parent_folder_id eq '").concat(n,"' and name eq '").concat(encodeURIComponent(r),"'"),{headers:this.props.authContext.headers}).then((function(e){e.data._embedded&&(s=e.data._embedded.collection[0].id)}));case 19:if(""!==s){e.next=22;break}return e.next=22,m.a.post(Pe+"/cms/instances/folder/ca_customer",{name:r,parent_folder_id:n,properties:{customer_email:r}},{headers:this.props.authContext.headers}).then((function(e){e.data&&(s=e.data.id)})).catch((function(e){var t;t=401===e.response.status?"Error creating Customer Folder: You are not authorized to access this resource. Your session might have timed out.":"Error creating Customer Folder: ".concat(JSON.stringify(e.response.data,null,2)),i.props.onAddContract("Error creating contract: "+t)}));case 22:return o="",e.next=26,m.a.get("".concat(Pe,"/cms/permissions?filter=name eq 'created'"),{headers:this.props.authContext.headers}).then((function(e){e.data._embedded&&(o=e.data._embedded.collection[0].id)}));case 26:(c=new FormData).append("file",this.state.selectedFile,this.state.selectedFile.name),m.a.post(Pe+"/css/v2/tenant/<replace with tenant_id>/content?avs-scan=false",c,{headers:{"Content-Type":"multipart/form-data",Authorization:this.props.authContext.headers.Authorization}}).then((function(e){var t;return t=i.isLoanContract()?"ca_loan_contract":"ca_contract",Object(m.a)({method:"post",url:"".concat(Pe,"/cms/instances/file/").concat(t),headers:i.props.authContext.headers,data:{name:i.state.newContractName,parent_folder_id:s,acl_id:o,renditions:[{name:e.data.entries[0].fileName,rendition_type:"primary",blob_id:e.data.entries[0].id},{name:"Brava rendition",mime_type:"application/vnd.blazon+json",rendition_type:"SECONDARY"}],properties:Object(p.a)({value:parseInt(i.state.newContractValue,10),status:"CREATED",requester_email:r,risk_classification:i.state.contractRisk,extracted_terms:i.state.extractedTerms},i.isLoanContract()&&{monthly_installments:parseInt(i.state.newContractMonthlyInstallments),yearly_income:parseInt(i.state.newContractYearlyIncome)}),traits:{ca_approval:Object(p.a)({"Automatic Approval":{is_required:!0,has_been_granted:!1,approver:"",approver_role:""},"Line Manager Approval":{is_required:!1,has_been_granted:!1,approver:"",approver_role:""},"Risk Manager Approval":{is_required:!1,has_been_granted:!1,approver:"",approver_role:""}},i.isLoanContract()&&{"Solvency Check":{is_required:!0,has_been_granted:!1,approver:"",approver_role:""}})}}})})).then((function(){i.closeDialog(),i.props.onAddContract()})).catch((function(e){var t,a=e.response.status;t=400===a?"The parameter name is mandatory":401===a?"You are not authorized to access this resource. Your session might have timed out.":JSON.stringify(e.response.data,null,2),i.props.onAddContract("Error creating contract: "+t)})).finally((function(){i.setState({showBackdrop:!1})}));case 29:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}},{key:"canSubmit",value:function(){return this.state.newContractName&&this.state.newContractValue>0&&this.state.selectedFile&&this.state.newContractRequesterEmail&&(!this.isLoanContract()||this.state.newContractMonthlyInstallments>0&&this.state.newContractYearlyIncome>0)}},{key:"isLoanContract",value:function(){return"loan-contract"===this.state.newContractType}},{key:"render",value:function(){var e=this;return Object(_.jsxs)(ae.a,{open:this.props.open,"aria-labelledby":"form-dialog-title",children:[Object(_.jsx)(ne.a,{id:"form-dialog-title",children:"Add Contract"}),Object(_.jsxs)(re.a,{className:"add-contract",children:[Object(_.jsxs)("div",{children:[Object(_.jsxs)("div",{className:"inline",children:[Object(_.jsx)("label",{htmlFor:"files",className:"MuiButtonBase-root MuiButton-root MuiButton-contained MuiButton-containedPrimary",children:"Select Document"}),Object(_.jsx)("input",{id:"files",type:"file",accept:"application/pdf",className:"file-input",onChange:this.selectFile})]}),Object(_.jsx)("div",{id:"fileName",className:"inline margin-start",ref:this.setFileNameInputRef})]}),Object(_.jsx)("br",{}),Object(_.jsxs)(ye.a,{row:!0,defaultValue:"standard-contract",name:"contract-types-radio-buttons-group",onChange:this.handleChangeContractType,children:[Object(_.jsx)(we.a,{value:"standard-contract",control:Object(_.jsx)(Se.a,{}),label:"Standard Contract",size:"small"}),Object(_.jsx)(we.a,{value:"loan-contract",control:Object(_.jsx)(Se.a,{}),label:"Loan Contract"})]}),Object(_.jsx)(se.a,{margin:"dense",id:"contract-name",label:"Document name",type:"text",defaultValue:"",fullWidth:!0,onChange:this.handleChangeContractName}),Object(_.jsx)(se.a,{margin:"dense",id:"contract-value",label:"Contract value",type:"number",InputProps:{inputProps:{min:1}},fullWidth:!0,onChange:this.handleChangeContractValue}),this.isLoanContract()&&Object(_.jsxs)(_.Fragment,{children:[Object(_.jsxs)(_e.a,{fullWidth:!0,children:[Object(_.jsx)(De.a,{id:"contract-monthly-installments-label",children:"Monthly installments"}),Object(_.jsxs)(Ne.a,{margin:"dense",labelId:"contract-monthly-installments-label",id:"contract-monthly-installments",label:"Monthly installments",type:"number",defaultValue:"",onChange:this.handleChangeContractMonthlyInstallments,children:[Object(_.jsx)(S.a,{value:12,children:"12"}),Object(_.jsx)(S.a,{value:24,children:"24"}),Object(_.jsx)(S.a,{value:36,children:"36"}),Object(_.jsx)(S.a,{value:48,children:"48"}),Object(_.jsx)(S.a,{value:60,children:"60"}),Object(_.jsx)(S.a,{value:72,children:"72"}),Object(_.jsx)(S.a,{value:84,children:"84"})]})]}),Object(_.jsx)(se.a,{margin:"dense",id:"contract-yearly-income",label:"Yearly income",type:"number",defaultValue:"",InputProps:{inputProps:{min:1}},fullWidth:!0,onChange:this.handleChangeContractYearlyIncome})]}),Object(_.jsx)(se.a,{margin:"dense",id:"contract-requester-email",label:"Contract requester email",type:"text",defaultValue:"",fullWidth:!0,onChange:this.handleChangeContractRequesterEmail})]}),Object(_.jsxs)(oe.a,{children:[Object(_.jsx)(y.a,{onClick:function(){e.submitContract()},variant:"contained",color:"primary",disabled:!this.canSubmit(),children:"Add"}),Object(_.jsx)(y.a,{onClick:function(){e.closeDialog()},color:"primary",children:"Cancel"})]}),Object(_.jsx)(H.a,{style:{zIndex:9999},open:this.state.showBackdrop,children:Object(_.jsx)(G.a,{color:"inherit"})})]})}}]),n}(c.a.Component);Re.contextType=Ie;var Ee=Re,Me="https://na-1-dev.api.opentext.com",Ve=function(e){return Object(_.jsx)(he.a,Object(p.a)({elevation:6,variant:"filled"},e))},ze=function(e){Object(R.a)(a,e);var t=Object(E.a)(a);function a(e){var n;return Object(B.a)(this,a),(n=t.call(this,e)).handleContractAdded=function(e){e?n.setState({snackBarSeverity:"error",snackBarMessage:e}):n.setState({addNumberOfContracts:n.state.addNumberOfContracts+1,snackBarSeverity:"success",snackBarMessage:"Contract added successfully"}),n.setState({showSnackBar:!0})},n.state={contracts:[],lineManagerAclId:"",riskManagerAclId:"",completedAclId:"",openContractDetails:!1,selectedContract:{properties:{}},openAddContract:!1,addNumberOfContracts:0,pageNumber:0,count:-1,openDocumentDialogView:!1,fileId:"",fileName:"",showBackdrop:!1,showSnackBar:!1,snackBarMessage:"",snackBarSeverity:"success"},n.handleCloseAddContract=n.handleCloseAddContract.bind(Object(P.a)(n)),n.handleCloseContractDetails=n.handleCloseContractDetails.bind(Object(P.a)(n)),n.handleCloseDocumentDialogView=n.handleCloseDocumentDialogView.bind(Object(P.a)(n)),n.handleSnackBarClose=n.handleSnackBarClose.bind(Object(P.a)(n)),n.handlePageNumber=n.handlePageNumber.bind(Object(P.a)(n)),n}return Object(I.a)(a,[{key:"handleCloseAddContract",value:function(){this.setState({openAddContract:!1})}},{key:"handleCloseContractDetails",value:function(){this.setState({openContractDetails:!1})}},{key:"handleCloseDocumentDialogView",value:function(){this.setState({openDocumentDialogView:!1})}},{key:"handleSnackBarClose",value:function(){this.setState({showSnackBar:!1})}},{key:"componentDidMount",value:function(){this.getAcls(),this.getContracts()}},{key:"componentDidUpdate",value:function(e,t){t.addNumberOfContracts===this.state.addNumberOfContracts&&t.pageNumber===this.state.pageNumber||this.getContracts()}},{key:"handlePageNumber",value:function(e){this.setState({pageNumber:e})}},{key:"getContracts",value:function(){var e=this;this.props.authContext.userName?(this.setState({showBackdrop:!0}),Object(m.a)({method:"get",url:Me+'/cms/instances/file/ca_contract/?include-total=true&sortby=create_time desc&filter=status eq "CREATED"&page='+(this.state.pageNumber+1),headers:this.props.authContext.headers}).then((function(t){e.setState({contracts:t.data&&t.data._embedded?t.data._embedded.collection:[],count:t.data.total})})).catch((function(t){var a="Could not get contracts: ";null!=t.response&&null!=t.response.data?a+=t.response.data.exception:a+=t.message,e.raiseError(e,a)})).finally((function(){e.setState({showBackdrop:!1})}))):this.setState({contracts:[],count:-1})}},{key:"getAcls",value:function(){var e=this;0!==this.state.lineManagerAclId.length&&0!==this.state.riskManagerAclId.length&&0!==this.state.completedAclId||Object(m.a)({method:"get",url:Me+'/cms/permissions?filter=name eq "line_manager_approval" or name eq "risk_manager_approval" or name eq "completed"',headers:this.props.authContext.headers}).then((function(t){if(t.data._embedded.collection.forEach((function(t){switch(t.name){case"line_manager_approval":e.setState({lineManagerAclId:t.id});break;case"risk_manager_approval":e.setState({riskManagerAclId:t.id});break;case"completed":e.setState({completedAclId:t.id})}})),0===e.state.lineManagerAclId.length||0===e.state.riskManagerAclId.length||0===e.state.completedAclId){e.raiseError(e,"Not all required ACLs exist in the repository")}})).catch((function(t){var a="Could not get ACLs: ";null!=t.response&&null!=t.response.data?a+=t.response.data.exception:a+=t.message,e.raiseError(e,a)}))}},{key:"openDocumentDialogView",value:function(e,t){this.setState({openDocumentDialogView:!0,fileId:e,fileName:t})}},{key:"startContractForApproval",value:function(e){var t=this;this.setState({showBackdrop:!0});var a={processDefinitionKey:"contract_approval",name:"Approve contract",outcome:"none",variables:[{name:"base_url",value:Me},{name:"contract_id",value:e},{name:"line_manager_approval_acl_id",value:this.state.lineManagerAclId},{name:"risk_manager_approval_acl_id",value:this.state.riskManagerAclId},{name:"completed_acl_id",value:this.state.completedAclId}],returnVariables:!0};Object(m.a)({method:"post",url:Me+"/workflow/v1/process-instances",headers:this.props.authContext.headers,data:a}).then((function(){t.setState({snackBarMessage:"Approval requested successfully."}),t.setState({showSnackBar:!0}),t.getContracts()})).catch((function(e){var a="Error requesting approval: ";a+=400===e.response.status?e.response.data.exception:e.message,t.raiseError(t,a)})).finally((function(){t.setState({showBackdrop:!1})}))}},{key:"showDetails",value:function(e){this.setState({selectedContract:e,openContractDetails:!0})}},{key:"getDateValue",value:function(e){return e?new Date(Date.parse(e)).toLocaleString():""}},{key:"openContractDialog",value:function(){this.setState({openAddContract:!0})}},{key:"raiseError",value:function(e,t){e.setState({snackBarSeverity:"error",snackBarMessage:t,showSnackBar:!0})}},{key:"render",value:function(){var e=this;return Object(_.jsxs)("div",{children:[Object(_.jsx)(y.a,{variant:"contained",color:"primary",disabled:!this.props.authContext.userName,startIcon:Object(_.jsx)(ve.a,{}),onClick:function(){return e.openContractDialog()},style:{margin:"0.25rem"},children:"Add"}),Object(_.jsx)("div",{className:"content-header",children:"All created contracts"}),Object(_.jsx)(M.a,{component:V.a,children:Object(_.jsxs)(z.a,{size:"small","aria-label":"a dense table",children:[Object(_.jsx)(q.a,{children:Object(_.jsxs)(L.a,{children:[Object(_.jsx)(F.a,{children:"Contract name"}),Object(_.jsx)(F.a,{align:"left",children:"Creation date"}),Object(_.jsx)(F.a,{align:"left",children:"Value"}),Object(_.jsx)(F.a,{align:"left",children:"Risk classification"}),Object(_.jsx)(F.a,{align:"left",children:"View document"}),Object(_.jsx)(F.a,{align:"left",children:"Action"}),Object(_.jsx)(F.a,{align:"left"})]})}),Object(_.jsx)(W.a,{children:this.state.contracts.map((function(t){return Object(_.jsxs)(L.a,{children:[Object(_.jsx)(F.a,{component:"th",scope:"row",children:t.name}),Object(_.jsx)(F.a,{align:"left",children:e.getDateValue(t.create_time)}),Object(_.jsx)(F.a,{align:"left",children:t.properties.value}),Object(_.jsx)(F.a,{align:"left",children:Object(_.jsx)(fe,{row:t})}),Object(_.jsx)(F.a,{align:"left",children:Object(_.jsx)(y.a,{size:"small",variant:"outlined",color:"primary",onClick:function(){e.openDocumentDialogView(t.id,t.name)},children:"Original"})}),Object(_.jsx)(F.a,{align:"left",children:Object(_.jsx)(y.a,{size:"small",variant:"outlined",color:"primary",onClick:function(){e.startContractForApproval(t.id)},children:"Request approval"})}),Object(_.jsx)(F.a,{align:"left",children:Object(_.jsx)(U.a,{size:"small",variant:"outlined",color:"primary",title:"Show details",onClick:function(){e.showDetails(t)},children:Object(_.jsx)(K.a,{})})})]},t.id)}))})]})}),Object(_.jsx)(ee,{pageNumber:this.state.pageNumber,count:this.state.count,handlePageNumber:this.handlePageNumber}),Object(_.jsx)(ke,{open:this.state.openContractDetails,selectedContract:this.state.selectedContract,parent:this,parentRaiseError:this.raiseError,onClose:this.handleCloseContractDetails}),Object(_.jsx)(Ee,{authContext:this.props.authContext,open:this.state.openAddContract,onAddContract:this.handleContractAdded,onClose:this.handleCloseAddContract}),Object(_.jsx)(ue,{open:this.state.openDocumentDialogView,fileId:this.state.fileId,onClose:this.handleCloseDocumentDialogView}),Object(_.jsx)(H.a,{style:{zIndex:9999},open:this.state.showBackdrop,children:Object(_.jsx)(G.a,{color:"inherit"})}),Object(_.jsx)(J.a,{anchorOrigin:{vertical:"bottom",horizontal:"center"},open:this.state.showSnackBar,autoHideDuration:5e3,onClose:this.handleSnackBarClose,action:Object(_.jsx)(c.a.Fragment,{children:Object(_.jsx)(U.a,{size:"small","aria-label":"close",color:"inherit",onClick:this.handleSnackBarClose,children:Object(_.jsx)(Q.a,{fontSize:"small"})})}),children:Object(_.jsx)(Ve,{onClose:this.handleSnackBarClose,severity:this.state.snackBarSeverity,children:this.state.snackBarMessage})})]})}}]),a}(c.a.Component),qe=function(e){return Object(_.jsx)(he.a,Object(p.a)({elevation:6,variant:"filled"},e))},Le=function(e){Object(R.a)(a,e);var t=Object(E.a)(a);function a(e){var n;return Object(B.a)(this,a),(n=t.call(this,e)).handlePageNumber=function(e){n.setState({pageNumber:e})},n.state={contracts:[],contractDetailsOpen:!1,selectedContract:{properties:{}},pageNumber:0,count:-1,openDocumentDialogView:!1,fileId:"",fileName:"",showBackdrop:!1,showSnackBar:!1,snackBarMessage:"",snackBarSeverity:"success"},n.handleCloseContractDetails=n.handleCloseContractDetails.bind(Object(P.a)(n)),n.handleCloseDocumentDialogView=n.handleCloseDocumentDialogView.bind(Object(P.a)(n)),n.handleSnackBarClose=n.handleSnackBarClose.bind(Object(P.a)(n)),n}return Object(I.a)(a,[{key:"componentDidMount",value:function(){this.getContracts()}},{key:"componentDidUpdate",value:function(e,t){t.pageNumber!==this.state.pageNumber&&this.getContracts()}},{key:"handleCloseDocumentDialogView",value:function(){this.setState({openDocumentDialogView:!1})}},{key:"openDocumentDialogView",value:function(e,t){this.setState({openDocumentDialogView:!0,fileId:e,fileName:t})}},{key:"getContracts",value:function(){var e=this;this.setState({showBackdrop:!0}),Object(m.a)({method:"get",url:"https://na-1-dev.api.opentext.com/cms/instances/file/ca_contract/?include-total=true&sortby=create_time desc&page="+(this.state.pageNumber+1),headers:this.props.authContext.headers}).then((function(t){e.setState({contracts:t.data&&t.data._embedded?t.data._embedded.collection:[],count:t.data.total})})).catch((function(t){var a="Could not get contracts: ";null!=t.response&&null!=t.response.data?a+=t.response.data.exception:a+=t.message,e.raiseError(e,a)})).finally((function(){e.setState({showBackdrop:!1})}))}},{key:"showDetails",value:function(e){this.setState({selectedContract:e,contractDetailsOpen:!0})}},{key:"getDateValue",value:function(e){return e?new Date(Date.parse(e)).toLocaleString():""}},{key:"handleCloseContractDetails",value:function(){this.setState({contractDetailsOpen:!1})}},{key:"handleSnackBarClose",value:function(){this.setState({showSnackBar:!1})}},{key:"raiseError",value:function(e,t){e.setState({snackBarSeverity:"error",snackBarMessage:t,showSnackBar:!0})}},{key:"render",value:function(){var e=this;return Object(_.jsxs)("div",{children:[Object(_.jsx)("div",{className:"content-header",children:"All contracts"}),Object(_.jsx)(M.a,{component:V.a,children:Object(_.jsxs)(z.a,{size:"small","aria-label":"a dense table",children:[Object(_.jsx)(q.a,{children:Object(_.jsxs)(L.a,{children:[Object(_.jsx)(F.a,{children:"Contract name"}),Object(_.jsx)(F.a,{align:"left",children:"Creation date"}),Object(_.jsx)(F.a,{align:"left",children:"Status"}),Object(_.jsx)(F.a,{align:"left",children:"Value"}),Object(_.jsx)(F.a,{align:"left",children:"Risk classification"}),Object(_.jsx)(F.a,{align:"left",children:"View document"}),Object(_.jsx)(F.a,{align:"left"})]})}),Object(_.jsx)(W.a,{children:this.state.contracts.map((function(t){return Object(_.jsxs)(L.a,{children:[Object(_.jsx)(F.a,{component:"th",scope:"row",children:t.name}),Object(_.jsx)(F.a,{align:"left",children:e.getDateValue(t.create_time)}),Object(_.jsx)(F.a,{align:"left",children:t.properties?t.properties.status:""}),Object(_.jsx)(F.a,{align:"left",children:t.properties?t.properties.value:""}),Object(_.jsx)(F.a,{align:"left",children:Object(_.jsx)(fe,{row:t})}),Object(_.jsx)(F.a,{align:"left",children:Object(_.jsx)(y.a,{size:"small",variant:"outlined",color:"primary",onClick:function(){e.openDocumentDialogView(t.id,t.name)},children:"Original"})}),Object(_.jsx)(F.a,{align:"left",children:Object(_.jsx)(U.a,{size:"small",variant:"outlined",color:"primary",title:"Show details",onClick:function(){e.showDetails(t)},children:Object(_.jsx)(K.a,{})})})]},t.id)}))})]})}),Object(_.jsx)(ee,{pageNumber:this.state.pageNumber,count:this.state.count,handlePageNumber:this.handlePageNumber}),Object(_.jsx)(ke,{open:this.state.contractDetailsOpen,selectedContract:this.state.selectedContract,parent:this,parentRaiseError:this.raiseError,onClose:this.handleCloseContractDetails}),Object(_.jsx)(ue,{open:this.state.openDocumentDialogView,fileId:this.state.fileId,onClose:this.handleCloseDocumentDialogView}),Object(_.jsx)(H.a,{style:{zIndex:9999},open:this.state.showBackdrop,children:Object(_.jsx)(G.a,{color:"inherit"})}),Object(_.jsx)(J.a,{anchorOrigin:{vertical:"bottom",horizontal:"center"},open:this.state.showSnackBar,autoHideDuration:5e3,onClose:this.handleSnackBarClose,action:Object(_.jsx)(c.a.Fragment,{children:Object(_.jsx)(U.a,{size:"small","aria-label":"close",color:"inherit",onClick:this.handleSnackBarClose,children:Object(_.jsx)(Q.a,{fontSize:"small"})})}),children:Object(_.jsx)(qe,{onClose:this.handleSnackBarClose,severity:this.state.snackBarSeverity,children:this.state.snackBarMessage})})]})}}]),a}(c.a.Component),Fe=a(97),We=a.n(Fe);function Ye(){var e=Object(o.useState)(0),t=Object(d.a)(e,2),a=t[0],n=t[1],r=Object(f.c)().authService;if(r.isPending())return Object(_.jsxs)("div",{className:"page-content",children:[Object(_.jsx)("p",{children:"Loading..."}),Object(_.jsx)("button",{style:{margin:"0.50rem"},onClick:function(){x(!0),O()},children:"Reset"})]});if(!r.isAuthenticated())return O(),Object(_.jsx)("div",{className:"page-content",children:Object(_.jsx)("p",{children:"Logging in ..."})});var s=We()(r.getAuthTokens().id_token).grp.map((function(e){var t=JSON.stringify(e);return t.substring(1,t.indexOf("@"))})),c={userName:r.getUser().preferred_username,idToken:r.getAuthTokens().id_token,groups:s,headers:{Authorization:"Bearer ".concat(r.getAuthTokens().access_token)}},i=0;return Object(_.jsxs)("div",{className:"App",children:[Object(_.jsx)(D,{authContext:c,logout:v}),c.groups.includes("contract_approval_users")?Object(_.jsxs)("div",{className:"page-content",children:[Object(_.jsxs)(u.a,{orientation:"horizontal",value:a,onChange:function(e,t){n(t)},children:[Object(_.jsx)(h.a,{className:"tab-caption",label:"Created Contracts"}),c.groups.includes("line_managers")&&Object(_.jsx)(h.a,{className:"tab-caption",label:"Line Manager Tasks"}),c.groups.includes("risk_managers")&&Object(_.jsx)(h.a,{className:"tab-caption",label:"Risk Manager Tasks"}),Object(_.jsx)(h.a,{className:"tab-caption",label:"All Contracts"})]}),Object(_.jsxs)(Be,{children:[Object(_.jsx)(A,{value:a,index:i++,children:Object(_.jsx)(ze,{authContext:c})}),c.groups.includes("line_managers")&&Object(_.jsx)(A,{value:a,index:i++,children:Object(_.jsx)(Oe,{authContext:c,taskname:"Line Manager Approval"})}),c.groups.includes("risk_managers")&&Object(_.jsx)(A,{value:a,index:i++,children:Object(_.jsx)(Oe,{authContext:c,taskname:"Risk Manager Approval"})}),Object(_.jsx)(A,{value:a,index:i++,children:Object(_.jsx)(Le,{authContext:c})})]})]}):Object(_.jsxs)("div",{className:"page-content",children:[Object(_.jsx)("p",{children:"You are not authorized to use this application"}),Object(_.jsx)("button",{style:{margin:"0.50rem"},onClick:function(){v(!0,c.idToken)},children:"Logout"})]})]})}var Ue=function(){return Object(_.jsx)(f.a,{authService:g,children:Object(_.jsx)(Ye,{})})};l.a.render(Object(_.jsx)(Ue,{}),document.getElementById("root"))}},[[330,1,2]]]);
//# sourceMappingURL=main.32f73141.chunk.js.map